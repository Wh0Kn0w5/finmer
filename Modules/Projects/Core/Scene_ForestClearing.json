{
	"!Type": "AssetScene",
	"ID": "8bd05185-f23d-43ac-bb88-300df2b54acc",
	"Name": "Scene_ForestClearing",
	"ScriptCustom": {
		"ID": "9af934a4-2810-46b0-be9f-4a7e1ee1b3c3",
		"Name": "Scene_ForestClearing_CustomScript"
	},
	"ScriptEnter": {
		"ID": "5aec94ec-a624-4419-82ec-ae69bfae3130",
		"Name": "Scene_ForestClearing_OnEnter"
	},
	"ScriptLeave": {
		"ID": "696c79fc-ffce-4696-9910-400ed64a67e7",
		"Name": "Scene_ForestClearing_OnLeave"
	},
	"IsPatch": false,
	"Root": {
		"Key": "Root",
		"IsState": false,
		"IsLink": false,
		"Title": "Root",
		"Highlight": false,
		"ButtonWidth": 1.0,
		"Children": [
			{
				"Key": "SavePoint_Clearing",
				"IsState": true,
				"IsLink": false,
				"ScriptAction": "Log(\"FOREST_CLEARING_SAVEPOINT\")\r\nStorage.SetFlag(\"savepoint\", false)",
				"ScriptAppear": "return Storage.GetFlag(\"savepoint\")",
				"Children": [
					{
						"IsState": false,
						"IsLink": true,
						"LinkTarget": "Clearing_C_Leave"
					}
				]
			},
			{
				"Key": "SQ02_Start",
				"IsState": true,
				"IsLink": false,
				"ScriptAction": "SaveData.TakeCheckpoint()\r\n\r\nText.SetVariable(\"sun\", GetIsNight() and \"moon\" or \"sun\")\r\nLog(\"SQ02_OPENING\")\r\n\r\nPreySense(Creature(\"CR_SQ02_Wolf_OV\"), EVoreStyle.OV, true)",
				"ScriptAppear": "return Storage.GetNumber(\"SQ02\") == 1",
				"Children": [
					{
						"Key": "SQ02_C_Approach",
						"IsState": false,
						"IsLink": false,
						"Title": "Approach",
						"Tooltip": "Walk forward confidently.",
						"Highlight": false,
						"ButtonWidth": 1.0,
						"Children": [
							{
								"Key": "SQ02_R_Approach",
								"IsState": true,
								"IsLink": false,
								"ScriptAction": "Log(\"SQ02_APPROACH\")",
								"Children": [
									{
										"Key": "SQ02_C_ApproachAgain",
										"IsState": false,
										"IsLink": false,
										"Title": "Approach",
										"Tooltip": "Get a bit closer still.",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"Children": [
											{
												"Key": "SQ02_R_ApproachAgain",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Log(\"SQ02_APPROACH_AGAIN\")",
												"Children": [
													{
														"Key": "SQ02_C_DoCombatOV",
														"IsState": false,
														"IsLink": false,
														"Title": "Uh-oh...",
														"Highlight": false,
														"ButtonWidth": 1.0,
														"ScriptAction": "Storage.SetFlag(\"SQ02_DIREWOLF_FOUGHT\", true)\r\n\r\nlocal state = Combat2()\r\nstate:AddParticipant(Player)\r\nstate:AddParticipant(Creature(\"CR_SQ02_Wolf_OV\"))\r\nstate:Begin()",
														"Children": [
															{
																"Key": "fggd",
																"IsState": true,
																"IsLink": true,
																"LinkTarget": "SQ02_R_Slay"
															}
														]
													}
												]
											}
										]
									},
									{
										"Key": "SQ02_C_ApproachStop",
										"IsState": false,
										"IsLink": false,
										"Title": "Stop",
										"Tooltip": "Freeze right where you are, and try to not look threatening.",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"Children": [
											{
												"Key": "SQ02_R_ApproachStop",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Log(\"SQ02_APPROACH_STOP\")",
												"Children": [
													{
														"Key": "SQ02_C_OfferSelf",
														"IsState": false,
														"IsLink": false,
														"Title": "Offer self",
														"Tooltip": "Gently reach out and pry apart the canine's lips.",
														"Highlight": false,
														"ButtonWidth": 1.0,
														"Children": [
															{
																"Key": "SQ02_R_OfferSelf",
																"IsState": true,
																"IsLink": false,
																"ScriptAction": "-- First play a sequence showing the vore happening\r\nLog(\"SQ02_WOLF_VORE_WILLING\")\r\nSleep(3)\r\nLog(\"SQ02_WOLF_VORE_WIN_POV\")\r\n\r\n-- Then use combat system to simulate digestion.\r\n-- Note: player is not expected to survive this, so no more nodes come after this one\r\nlocal awoo = Creature(\"CR_SQ02_Wolf_OV\")\r\nlocal state = Combat2()\r\nstate:AddParticipant(Player)\r\nstate:AddParticipant(awoo)\r\nstate:SetVored(awoo, Player)\r\nstate:Begin()",
																"Children": []
															}
														]
													},
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_C_OfferFish"
													},
													{
														"Key": "SQ02_C_Bellyrub",
														"IsState": false,
														"IsLink": false,
														"Title": "Bellyrub",
														"Tooltip": "Well, you got this close, what else did you want to do?",
														"Highlight": false,
														"ButtonWidth": 1.0,
														"Children": [
															{
																"Key": "SQ02_R_Bellyrub",
																"IsState": true,
																"IsLink": false,
																"ScriptAction": "Log(\"SQ02_BELLYRUB\")\r\nPreySense(Creature(\"CR_SQ02_Wolf_OV\"), EVoreStyle.OV, false)",
																"Children": [
																	{
																		"Key": "SQ02_C_EndoAccept",
																		"IsState": false,
																		"IsLink": false,
																		"Title": "Accept",
																		"Tooltip": "Place your paws on the inviting-looking tongue.",
																		"Highlight": false,
																		"ButtonWidth": 1.0,
																		"Children": [
																			{
																				"Key": "SQ02_R_EatPlayerSafe",
																				"IsState": true,
																				"IsLink": false,
																				"ScriptAction": "Storage.SetFlag(\"forest_direwolf_friendly\", true)\r\nStorage.SetNumber(\"SQ02\", 3) -- disable clearing event\r\n\r\nlocal wuff = Creature(\"CR_SQ02_Wolf_OV\")\r\nwuff.PredatorDigests = false -- enable endo mode\r\n\r\n-- willing endo vore sequence\r\nLog(\"SQ02_WOLF_ENDO_VORE_WIN_POV\")\r\nText.SetContext(\"predator\", wuff)\r\n\r\nlocal state = Combat2()\r\nstate:AddParticipant(Player)\r\nstate:AddParticipant(wuff)\r\nstate:SetVored(wuff, Player)\r\nstate:OnRoundEnd(function(round)\r\n    if round >= 5 then\r\n        state:End()\r\n    end\r\nend)\r\nstate:Begin()\r\n\r\n-- after combat ends\r\nSetScene(\"Scene_DireWolf_Stomach\")",
																				"Children": []
																			}
																		]
																	},
																	{
																		"Key": "SQ02_R_EndoRun",
																		"IsState": false,
																		"IsLink": false,
																		"Title": "Back away",
																		"Tooltip": "Get away from this dangerous predator.",
																		"Highlight": false,
																		"ButtonWidth": 1.0,
																		"ScriptAction": "Log(\"SQ02_WOLF_ENDO_RUNAWAY\")",
																		"Children": [
																			{
																				"IsState": true,
																				"IsLink": true,
																				"LinkTarget": "SQ02_R_EatPlayerSafe"
																			}
																		]
																	}
																]
															}
														]
													}
												]
											}
										]
									},
									{
										"Key": "SQ02_C_ApproachBack",
										"IsState": false,
										"IsLink": false,
										"Title": "Back away",
										"Tooltip": "Slowly back away from the dire wolf.",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"Children": [
											{
												"Key": "SQ02_R_ApproachBack",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Log(\"SQ02_APPROACH_BACK\")",
												"Children": [
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_C_DoCombatOV"
													}
												]
											}
										]
									},
									{
										"Key": "SQ02_C_OfferFish",
										"IsState": false,
										"IsLink": false,
										"Title": "Offer fish",
										"Tooltip": "The wolf appears to have caught on to the scent of your backpack.",
										"Highlight": true,
										"ButtonWidth": 1.0,
										"ScriptAppear": "return Player:HasItem(\"U_FoodFish1Raw\") or Player:HasItem(\"U_FoodFish1Cooked\")",
										"Children": [
											{
												"Key": "SQ02_R_OfferFish",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "if Player:HasItem(\"U_FoodFish1Raw\") then\r\n    Player:TakeItem(\"U_FoodFish1Raw\")\r\nelse\r\n    Player:TakeItem(\"U_FoodFish1Cooked\")\r\nend\r\n\r\nLog(\"SQ02_OFFER_FISH\")",
												"Children": [
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_C_EndoAccept"
													},
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_R_EndoRun"
													}
												]
											}
										]
									}
								]
							}
						]
					},
					{
						"Key": "SQ02_C_SneakCloser",
						"IsState": false,
						"IsLink": false,
						"Title": "Sneak closer",
						"Tooltip": "[Wits] Try to approach without being detected.",
						"Highlight": false,
						"ButtonWidth": 1.0,
						"Children": [
							{
								"Key": "SQ02_R_SneakFail",
								"IsState": true,
								"IsLink": false,
								"ScriptAction": "Log(\"SQ02_SNEAK_FAIL\")",
								"ScriptAppear": "return Player.Wits < 6",
								"Children": [
									{
										"IsState": false,
										"IsLink": true,
										"LinkTarget": "SQ02_C_ApproachAgain"
									},
									{
										"IsState": false,
										"IsLink": true,
										"LinkTarget": "SQ02_C_ApproachStop"
									},
									{
										"IsState": false,
										"IsLink": true,
										"LinkTarget": "SQ02_C_ApproachBack"
									},
									{
										"IsState": false,
										"IsLink": true,
										"LinkTarget": "SQ02_C_OfferFish"
									}
								]
							},
							{
								"Key": "SQ02_R_SneakCloser",
								"IsState": true,
								"IsLink": false,
								"ScriptAction": "Log(\"SQ02_SNEAK_OK\")",
								"Children": [
									{
										"Key": "SQ02_C_Slay",
										"IsState": false,
										"IsLink": false,
										"Title": "Slay",
										"Tooltip": "A clean cut should do it. However grim, the townsfolk would probably appreciate it.",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"Children": [
											{
												"Key": "SQ02_R_Slay_NoWep",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Log(\"SQ02_SNEAK_SLAY_NOWEAPON\")",
												"ScriptAppear": "return Player.EquippedWeapon == nil",
												"Children": [
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_C_Slay"
													},
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_C_SneakBellyrub"
													}
												]
											},
											{
												"Key": "SQ02_R_Slay",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Text.SetVariable(\"weapon\", Player.EquippedWeapon.Alias)\r\nLog(\"SQ02_SNEAK_SLAY_OK\")\r\n\r\n-- Progress the quest\r\nStorage.SetNumber(\"SQ02\", 2)\r\nJournal.Update(\"SQ02\", 20)\r\nPlayer:GiveItem(\"I_SQ02_WolfTrophy\", true)\r\n\r\n-- Award XP when fought stealthily (otherwise the combat already awarded XP)\r\nif not Storage.GetFlag(\"SQ02_DIREWOLF_FOUGHT\") then\r\n    Player:AwardXP(RewardXP.SQ02_StealthSlay)\r\nend",
												"Children": [
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "Clearing_C_Leave"
													}
												]
											}
										]
									},
									{
										"Key": "SQ02_C_SneakBellyrub",
										"IsState": false,
										"IsLink": false,
										"Title": "Bellyrub",
										"Tooltip": "Well, you got this close, what else did you want to do?",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"Children": [
											{
												"Key": "SQ02_R_SneakBellyrub",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Log(\"SQ02_BELLYRUB_SNEAK\")",
												"Children": [
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_C_EndoAccept"
													},
													{
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "SQ02_R_EndoRun"
													}
												]
											}
										]
									}
								]
							}
						]
					},
					{
						"Key": "SQ02_C_SneakAway",
						"IsState": false,
						"IsLink": false,
						"Title": "Sneak away",
						"Tooltip": "[Wits] Try to get away again without being noticed.",
						"Highlight": false,
						"ButtonWidth": 1.0,
						"Children": [
							{
								"IsState": true,
								"IsLink": true,
								"LinkTarget": "SQ02_R_SneakFail"
							}
						]
					}
				]
			},
			{
				"Key": "Abandoned",
				"IsState": true,
				"IsLink": false,
				"ScriptAction": "Text.SetVariable(\"sun\", GetIsNight() and \"moon\" or \"sun\")\r\nLog(\"SQ02_ABANDONED\")",
				"Children": [
					{
						"Key": "Clearing_C_Camp",
						"IsState": false,
						"IsLink": false,
						"Title": "Rest",
						"Tooltip": "This looks like a decent spot to set up camp.",
						"Highlight": false,
						"ButtonWidth": 1.0,
						"Children": [
							{
								"Key": "Clearing_R_Camp",
								"IsState": true,
								"IsLink": false,
								"Children": [
									{
										"Key": "Clearing_C_Save",
										"IsState": false,
										"IsLink": false,
										"Title": "Save",
										"Tooltip": "Record your adventure so far.",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"ScriptAppear": "return not has_slept_in_clearing",
										"Children": [
											{
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "has_slept_in_clearing = true\r\nSaveData.ShowSaveDialog()",
												"Children": [
													{
														"IsState": false,
														"IsLink": false,
														"Title": "Continue",
														"Highlight": false,
														"ButtonWidth": 1.0,
														"Children": [
															{
																"Key": "AutoLink",
																"IsState": true,
																"IsLink": true,
																"LinkTarget": "Clearing_R_Camp"
															}
														]
													}
												]
											}
										]
									},
									{
										"Key": "Clearing_C_Sleep",
										"IsState": false,
										"IsLink": false,
										"Title": "Sleep",
										"Tooltip": "Sit a moment and rest.",
										"Highlight": false,
										"ButtonWidth": 1.0,
										"Children": [
											{
												"Key": "Clearing_R_Sleep",
												"IsState": true,
												"IsLink": false,
												"ScriptAction": "Log(\"FOREST_SLEEP\")\r\nRest()\r\nLog(\"FOREST_SLEEP_WAKEUP\")",
												"Children": [
													{
														"Key": "AutoLink",
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "Clearing_C_Save"
													},
													{
														"Key": "AutoLink",
														"IsState": false,
														"IsLink": true,
														"LinkTarget": "Clearing_C_Leave"
													}
												]
											}
										]
									},
									{
										"IsState": false,
										"IsLink": true,
										"LinkTarget": "Clearing_C_Leave"
									}
								]
							}
						]
					},
					{
						"Key": "Clearing_C_Leave",
						"IsState": false,
						"IsLink": false,
						"Title": "Leave",
						"Tooltip": "Leave this clearing behind.",
						"Highlight": false,
						"ButtonWidth": 1.0,
						"Children": [
							{
								"Key": "Clearing_R_Leave",
								"IsState": true,
								"IsLink": false,
								"ScriptAction": "SetScene(\"Scene_Forest\")",
								"Children": []
							}
						]
					}
				]
			}
		]
	}
}